<!-- Header r√©utilisable -->
<app-header></app-header>

<!-- Banni√®re de la page -->
<section class="page-banner">
  <div class="container">
    <h1>D√©marches Administratives</h1>
    <p>Trouvez toutes les informations pour vos d√©marches en ligne</p>
  </div>
</section>

<!-- Guide rapide -->
<section class="guide-rapide">
  <div class="container">
    <div class="guide-content">
      <div class="guide-text">
        <h2>üöÄ Simplifiez vos d√©marches</h2>
        <p>D√©couvrez nos guides d√©taill√©s pour r√©aliser vos d√©marches administratives en toute simplicit√©.</p>
      </div>
      <div class="guide-stats">
        <div class="stat-item">
          <span class="stat-number">{{ demarches.length }}</span>
          <span class="stat-label">D√©marches</span>
        </div>
        <div class="stat-item">
          <span class="stat-number">{{ categories.length - 1 }}</span>
          <span class="stat-label">Cat√©gories</span>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Filtres et recherche -->
<section class="filtres-section">
  <div class="container">
    <div class="filtres-header">
      <div class="search-bar">
        <div class="search-input-group">
          <i class="fas fa-search"></i>
          <input type="text" 
                 [(ngModel)]="rechercheTexte" 
                 placeholder="Rechercher une d√©marche..." 
                 class="search-input">
        </div>
      </div>
      
      <div class="filtres-controls">
        <select [(ngModel)]="difficulteSelectionnee" class="filtre-select">
          <option value="toutes">Toutes difficult√©s</option>
          <option value="facile">Facile</option>
          <option value="moyenne">Moyenne</option>
          <option value="difficile">Difficile</option>
        </select>
        
        <select [(ngModel)]="triPar" class="filtre-select">
          <option value="titre">Trier par titre</option>
          <option value="difficulte">Trier par difficult√©</option>
          <option value="duree">Trier par dur√©e</option>
        </select>
        
        <button class="reset-btn" (click)="resetFiltres()" title="R√©initialiser les filtres">
          <i class="fas fa-undo"></i>
        </button>
      </div>
    </div>

    <!-- Filtres par cat√©gorie -->
    <div class="categories-filter">
      <button class="category-btn" 
              *ngFor="let categorie of categories"
              [class.active]="categorieSelectionnee === categorie.id"
              [style.border-color]="categorieSelectionnee === categorie.id ? categorie.couleur : '#ddd'"
              [style.color]="categorieSelectionnee === categorie.id ? categorie.couleur : '#666'"
              (click)="changerCategorie(categorie.id)">
        <i [class]="categorie.icone"></i>
        {{ categorie.nom }}
      </button>
    </div>
  </div>
</section>

<!-- Liste des d√©marches -->
<section class="demarches-section">
  <div class="container">
    <div class="demarches-header">
      <h2>
             {{ demarchesFiltrees.length }} 
        {{ demarchesFiltrees.length > 1 ? 'd√©marches trouv√©es' : 'd√©marche trouv√©e' }}
        {{ categorieSelectionnee !== 'toutes' ? 'dans ' + getNomCategorie(categorieSelectionnee) : '' }}
      </h2>
    </div>

    <!-- Grille des d√©marches -->
    <div class="demarches-grid">
      <div class="demarche-card" *ngFor="let demarche of demarchesFiltrees" (click)="selectionnerDemarche(demarche)">
        <!-- <div class="card-header">
          <div class="card-badges">
            <span class="category-badge" [style.background-color]="getCouleurCategorie(demarche.categorie)">
              <i [class]="getIconeCategorie(demarche.categorie)"></i>
              {{ categories.find(c => c.id === demarche.categorie)?.nom }}
                
            </span>
            <span class="difficulte-badge" [style.background-color]="getDifficulteCouleur(demarche.difficulte)">
              {{ getDifficulteLabel(demarche.difficulte) }}
            </span>
          </div>
        </div> -->
<div class="card-header">
  <div class="card-badges">
    <span class="category-badge" [style.background-color]="getCouleurCategorie(demarche.categorie)">
      <i [class]="getIconeCategorie(demarche.categorie)"></i>
      {{ getNomCategorie(demarche.categorie) }}
    </span>
    <span class="difficulte-badge" [style.background-color]="getDifficulteCouleur(demarche.difficulte)">
      {{ getDifficulteLabel(demarche.difficulte) }}
    </span>
  </div>
</div>
        <div class="card-content">
          <h3>{{ demarche.titre }}</h3>
          <p class="description">{{ demarche.description }}</p>

          <div class="card-infos">
            <div class="info-item">
              <i class="fas fa-clock"></i>
              <span>{{ demarche.duree }}</span>
            </div>
            <div class="info-item">
              <i class="fas fa-euro-sign"></i>
              <span>{{ demarche.cout }}</span>
            </div>
            <div class="info-item">
              <i class="fas fa-calendar-alt"></i>
              <span>{{ demarche.delaiTraitement }}</span>
            </div>
          </div>

          <div class="documents-preview">
            <h4>Documents requis :</h4>
            <ul>
              <li *ngFor="let doc of demarche.documentsRequis.slice(0, 3)">{{ doc }}</li>
              <li *ngIf="demarche.documentsRequis.length > 3" class="more-docs">
                +{{ demarche.documentsRequis.length - 3 }} autres documents
              </li>
            </ul>
          </div>
        </div>

        <div class="card-footer">
          <div class="etapes-count">
            <i class="fas fa-list-ol"></i>
            {{ demarche.etapes.length }} √©tapes
          </div>
          <button class="voir-details-btn">
            Voir le guide
            <i class="fas fa-arrow-right"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Message si aucun r√©sultat -->
    <div class="no-results" *ngIf="demarchesFiltrees.length === 0">
      <i class="fas fa-search"></i>
      <h3>Aucune d√©marche trouv√©e</h3>
      <p>Essayez de modifier vos crit√®res de recherche ou de s√©lectionner une autre cat√©gorie.</p>
      <button class="btn btn-primary" (click)="resetFiltres()">
        Voir toutes les d√©marches
      </button>
    </div>
  </div>
</section>

<!-- Modal de d√©tails de la d√©marche -->
<div class="demarche-modal-overlay" *ngIf="demarcheSelectionnee" (click)="fermerDetails()">
  <div class="demarche-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div class="modal-title">
        <h1>{{ demarcheSelectionnee.titre }}</h1>
        <div class="modal-badges">
          <span class="category-badge" [style.background-color]="getCouleurCategorie(demarcheSelectionnee.categorie)">
            <i [class]="getIconeCategorie(demarcheSelectionnee.categorie)"></i>
            <!-- {{ categories.find(c => c.id === demarcheSelectionnee.categorie)?.nom }} -->
              <!-- {{ categorieSelectionnee | categorieNom:categories }} -->
                
          </span>
          <span class="difficulte-badge" [style.background-color]="getDifficulteCouleur(demarcheSelectionnee.difficulte)">
            {{ getDifficulteLabel(demarcheSelectionnee.difficulte) }}
          </span>
        </div>
      </div>
      <button class="close-btn" (click)="fermerDetails()">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <div class="modal-content">
      <!-- Navigation des onglets -->
      <div class="tabs-navigation">
        <button class="tab-btn" 
                [class.active]="etapeActive === 0"
                (click)="changerEtape(0)">
          <i class="fas fa-info-circle"></i>
          Informations
        </button>
        <button class="tab-btn" 
                [class.active]="etapeActive === 1"
                (click)="changerEtape(1)">
          <i class="fas fa-list-ol"></i>
          √âtapes ({{ demarcheSelectionnee.etapes.length }})
        </button>
        <button class="tab-btn" 
                [class.active]="etapeActive === 2"
                (click)="changerEtape(2)">
          <i class="fas fa-file-download"></i>
          Formulaires
        </button>
        <button class="tab-btn" 
                [class.active]="etapeActive === 3"
                (click)="changerEtape(3)">
          <i class="fas fa-question-circle"></i>
          FAQ
        </button>
      </div>

      <!-- Contenu des onglets -->
      <div class="tab-content">
        <!-- Onglet Informations -->
        <div class="tab-panel" *ngIf="etapeActive === 0">
          <div class="info-section">
            <h3>Description</h3>
            <p>{{ demarcheSelectionnee.description }}</p>
          </div>

          <div class="info-grid">
            <div class="info-card">
              <i class="fas fa-clock"></i>
              <h4>Dur√©e</h4>
              <p>{{ demarcheSelectionnee.duree }}</p>
            </div>
            <div class="info-card">
              <i class="fas fa-euro-sign"></i>
              <h4>Co√ªt</h4>
              <p>{{ demarcheSelectionnee.cout }}</p>
            </div>
            <div class="info-card">
              <i class="fas fa-calendar-alt"></i>
              <h4>D√©lai de traitement</h4>
              <p>{{ demarcheSelectionnee.delaiTraitement }}</p>
            </div>
            <div class="info-card">
              <i class="fas fa-check-circle"></i>
              <h4>Validit√©</h4>
              <p>{{ demarcheSelectionnee.validite }}</p>
            </div>
          </div>

          <div class="documents-section">
            <h3>Documents requis</h3>
            <ul class="documents-list">
              <li *ngFor="let doc of demarcheSelectionnee.documentsRequis">
                <i class="fas fa-file"></i>
                {{ doc }}
              </li>
            </ul>
          </div>

          <div class="conseils-section" *ngIf="demarcheSelectionnee.conseils.length > 0">
            <h3>üí° Conseils pratiques</h3>
            <ul class="conseils-list">
              <li *ngFor="let conseil of demarcheSelectionnee.conseils">
                <i class="fas fa-lightbulb"></i>
                {{ conseil }}
              </li>
            </ul>
          </div>

          <div class="contact-section">
            <h3>Contact</h3>
            <div class="contact-card">
              <h4>{{ demarcheSelectionnee.contact.service }}</h4>
              <div class="contact-info">
                <div class="contact-item">
                  <i class="fas fa-phone"></i>
                  <span>{{ demarcheSelectionnee.contact.telephone }}</span>
                </div>
                <div class="contact-item">
                  <i class="fas fa-envelope"></i>
                  <span>{{ demarcheSelectionnee.contact.email }}</span>
                </div>
                <div class="contact-item">
                  <i class="fas fa-clock"></i>
                  <span>{{ demarcheSelectionnee.contact.horaires }}</span>
                </div>
              </div>
              <button class="btn btn-primary" (click)="contacterService(demarcheSelectionnee.contact)">
                Contacter le service
              </button>
            </div>
          </div>
        </div>

        <!-- Onglet √âtapes -->
        <div class="tab-panel" *ngIf="etapeActive === 1">
          <div class="etapes-timeline">
            <div class="etape-item" 
                 *ngFor="let etape of demarcheSelectionnee.etapes; let i = index"
                 [class.obligatoire]="etape.obligatoire">
              <div class="etape-number">
                <span>{{ etape.numero }}</span>
              </div>
              <div class="etape-content">
                <div class="etape-header">
                  <h4>{{ etape.titre }}</h4>
                  <div class="etape-badges">
                    <span class="duree-badge">
                      <i class="fas fa-clock"></i>
                      {{ etape.dureeEstimee }}
                    </span>
                    <span class="obligatoire-badge" *ngIf="etape.obligatoire">
                      Obligatoire
                    </span>
                  </div>
                </div>
                <p>{{ etape.description }}</p>
                
                <div class="etape-documents" *ngIf="etape.documentsNecessaires.length > 0">
                  <h5>Documents n√©cessaires :</h5>
                  <ul>
                    <li *ngFor="let doc of etape.documentsNecessaires">
                      <i class="fas fa-file"></i>
                      {{ doc }}
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Onglet Formulaires -->
        <div class="tab-panel" *ngIf="etapeActive === 2">
          <div class="formulaires-section">
            <h3>Formulaires √† t√©l√©charger</h3>
            <div class="formulaires-list">
              <div class="formulaire-item" *ngFor="let formulaire of demarcheSelectionnee.formulaires">
                <div class="formulaire-info">
                  <i class="fas fa-file-pdf"></i>
                  <span>{{ formulaire }}</span>
                </div>
                <button class="btn btn-secondary" (click)="telechargerFormulaire(formulaire)">
                  <i class="fas fa-download"></i>
                  T√©l√©charger
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Onglet FAQ -->
        <div class="tab-panel" *ngIf="etapeActive === 3">
          <div class="faq-section">
            <h3>Questions fr√©quentes</h3>
            <div class="faq-list">
              <div class="faq-item" *ngFor="let faq of demarcheSelectionnee.faq">
                <div class="faq-question">
                  <i class="fas fa-question-circle"></i>
                  <strong>{{ faq.question }}</strong>
                </div>
                <div class="faq-reponse">
                  <p>{{ faq.reponse }}</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Section aide -->
<section class="aide-section">
  <div class="container">
    <div class="aide-content">
      <div class="aide-text">
        <h3>Besoin d'aide ?</h3>
        <p>Notre √©quipe est l√† pour vous accompagner dans vos d√©marches administratives.</p>
      </div>
      <div class="aide-actions">
        <button class="btn btn-primary">
          <i class="fas fa-phone"></i>
          Nous contacter
        </button>
        <button class="btn btn-secondary">
          <i class="fas fa-calendar-plus"></i>
          Prendre rendez-vous
        </button>
      </div>
    </div>
  </div>
</section>

<!-- Footer r√©utilisable -->
<app-footer></app-footer>
